version: 2

jobs:
  build:
    docker:
      # SEE https://hub.docker.com/r/circleci/golang/
      - image: circleci/golang:1.11

    working_directory: /tmp/gostore

    environment:
      TEST_RESULTS: /tmp/test-results

    pre:
      - go get github.com/mattn/goveralls

    steps:
      - checkout
      - run: mkdir -p $TEST_RESULTS

      - run:
          name: Run unit tests
          command: go test -v -coverprofile=$TEST_RESULTS/coverage.out

    post:
      - goveralls -coverprofile=$TEST_RESULTS/coverage.out -service=circle-ci -repotoken=$COVERALLS_TOKEN